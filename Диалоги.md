По сути своей, диалоги это программируемая [система нодов](https://github.com/Andruxioid/mappet_ru/blob/main/%D0%9D%D0%BE%D0%B4%D1%8B.md), которая позволяет вам создавать развилистые разговоры для ваших карт. Диалоги основаны на нодовой системе событий, поэтому является возможным также исполнять различные действия (к примеру команды или условия), или подключать разные ветки диалогов в зависимости от состояний игрока.
 
Диалоги можно вызвать также посредством [триггеров](https://github.com/Andruxioid/mappet_ru/blob/main/%D0%A2%D1%80%D0%B8%D0%B3%D0%B3%D0%B5%D1%80.md), или [командой](https://github.com/mchorse/mappet/wiki/Commands#dialogue-commands) `/mp dialogue open`.
 
Диалогами можно управлять в [главной панели Маппет](https://github.com/Andruxioid/mappet_ru/blob/main/%D0%93%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F%20%D0%BF%D0%B0%D0%BD%D0%B5%D0%BB%D1%8C%20%D0%9C%D0%B0%D0%BF%D0%BF%D0%B5%D1%82%D0%B0.md). Четвёртая панель в левом боковом меню откроет редактор диалогов.
 
## Редактирование
 
Как только вы создадите или выберете диалог, вы увидите вот такой редактор:
 
![Редактор диалогов](https://i.imgur.com/vbNscqe.png)
 
Диалоговая система нодов поддерживает следующие типы нодов:
 
* **Все** ноды событий (кроме нода **Таймер**)
* Нод **Ответ** позволяет дать ответ в диалоге из опций, которые выбирает игрок
* Нод **Реакция** позволяет дать реакцию (по сути тот же ответ) в диалоге от того, с кем игрок имеет диалог
* Нод **Крафт** позволяет открыть рецепт крафта, который будет предложен игроку в качестве бартера
* Нод **Квест** позволяет выдавать игроку новые квесты или принимать уже завершенные
 
### Нод "Ответ"
 
Нод "Ответ" даёт игроку возможность выбрать определённый ответ из предложенных ответов в диалоге. Поле **Содержание** позволяет вам написать текст, который игрок будет использовать в качестве ответа в диалоге. Вы можете использовать то же форматирование, что и в [описаниях квестов](https://github.com/Andruxioid/mappet_ru/blob/main/%D0%9A%D0%B2%D0%B5%D1%81%D1%82%D1%8B.md#%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D1%8F). Также, вы можете выбрать цвет текста используя средство выбора под полем содержания.
 
### Нод "Реакция"
 
Нод "Реакция" предоставляет реакцию NPC либо на начало диалога, либо на ответ игрока. Поле **Содержание** позволяет вам написать текст, на который игрок будет отвечать в диалоге. Вы можете использовать то же форматирование, что и в [описаниях квестов](https://github.com/Andruxioid/mappet_ru/blob/main/%D0%9A%D0%B2%D0%B5%D1%81%D1%82%D1%8B.md#%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D1%8F). Также, вы можете выбрать цвет текста используя средство выбора под полем содержания.
 
Кнопки Выбрать | Редактировать под вышеупомянутыми полями позволяют вам выбрать морф, отображаемый в правой части главной панели во время диалога. Вы можете использовать любой морф, однако морф частиц `particle` с ванильными партиклами и морф `snowstorm` **работать не будут**! Все остальные возможности морфов, такие как анимация поз работать при переходе от одной реакции к другой, когда игрок выбирает ответ.
 
### Нод "Крафт"
 
Нод "Крафт" предлагает игроку в диалоге рецепт крафта, с заданным под написью **Рецепт крафта** ID. 
 
### Нод "Квест"
 
Нод "Квест" предлагает игроку квест(ы), в зависимости от цепочки квестов с заданным ID под надписью **Цепочка квестов**. Помните, что диалог будет отображать только те квесты, которые соотносятся с текущими свойствами квестодателя/квестополучателя, запрашиваемыми цепочках квестов. Для более детальной информации, посетите страницу [квестовых цепочек](https://github.com/Andruxioid/mappet_ru/blob/main/%D0%A6%D0%B5%D0%BF%D0%BE%D1%87%D0%BA%D0%B8-%D0%BA%D0%B2%D0%B5%D1%81%D1%82%D0%BE%D0%B2.md#%D0%BD%D0%BE%D0%B4-%D0%BA%D0%B2%D0%B5%D1%81%D1%82%D0%B0).
 
## Иерархия
 
Так же, как и с событиями, вам необходимо [указать главный нод](https://github.com/Andruxioid/mappet_ru/blob/main/%D0%A1%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F.md#%D0%B8%D0%B5%D1%80%D0%B0%D1%80%D1%85%D0%B8%D1%8F). Однако, кроме указания главного нода есть ещё и определённый порядок исполнения нодов, которого вам нужно придерживаться. Взгляните на этот пример: 
 
![Пример диалога](https://i.imgur.com/GO9qmEl.png)
 
Для каждой стадии диалога, вам необходим нод "Реакция" и либо:
 
* Один нод "Квест"
* Один нод "Крафт"
* Один или более нодов "Ответ"
 
Но реакции обязательно должен иметь по крайней мере непрямую связь с **хотя бы одним** из этих нодов. Взгляните на следующий диалог:
 
![Пример диалога с большей сложностью](https://i.imgur.com/GDrmfVv.png)
 
Вы можете добавлять дополнительные ноды "Состояние", "Переключатель" и "Команда" в качестве исходящих нодов от нодов "Ответ", "Реакция", "Крафт" или "Квест", или даже между ними. Самая важная часть заключается в том, что на каждую стадию диалога у вас должен быть один нод "Реакция", присоединённый к минимум одному ноду "Ответ", ил иже к одиночным нодам "Крафт" или "Квест". Тем не менее, **Нод "Реакция" никогда нельзя соединять с другим нодом "Реакция"** без посредника в виде нодов "Ответ", "Крафт" или "Квест", во всех иных случаях у вас выйдут непоследовательности.
 
Напоследок, вам стоит привязывать ноды "Ответ", "Крафт" или "Квест" к другим нодам "Реакция", если вы хотите отправить игрока в начало или какую-либо другю точку диалога, что и происходит с нодом `quest`, привязанному к ноду `Hi!`, который вернёт игрока на начало диалога. Если на его месте не будет нода "Ответ", "Крафт" или "Квест", то **диалог закочнится**.
 
## Механики
 
Стоит сказать, что у диалогов есть всего одна специальная мехника, о которой вам нужно знать.
 
**Как только игрок откроет диалог**, к состоянию с ID `dialogue.DIALOGUE_ID` будет добавлена `1`. Так что, если игрок открыл диалог `mchorse.greetings`, то к состоянию игрока `dialogue.mchorse.greetings` будет добавлена `1` (вы можете проверить это посредством открытия диалога и исполнения команды `/mp state print YOUR_USERNAME`).
